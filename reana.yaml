version: 0.9.4
workflow:
  type: serial
  specification:
    steps:
      - name       : rx_tests 
        kerberos   : true
        environment: 'docker.io/acampove/rx_run3:v4.4'
        kubernetes_memory_limit: '1Gi'
        kubernetes_cpu_request : '4'
        commands:
        - |
            export ZFIT_DISABLE_TF_WARNINGS=1
            export PYTHONPATH=/tmp/rx/local
            export MPLCONFIGDIR=/tmp/rx/mplt

            source /root_install/bin/thisroot.sh
            echo "1. ROOT found at $(which root)"
            pip install --target /tmp/rx/local --no-deps -r requirements.txt

            source /root_install/bin/thisroot.sh
            echo "2. ROOT found at $(which root)"
            pytest -n 2 src/rx_plots/tests
