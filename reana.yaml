version: 0.9.4
workflow:
  type: serial
  specification:
    steps:
      - name       : rx_tests 
        kerberos   : true
        environment: 'docker.io/acampove/rx_run3:v4.4'
        kubernetes_memory_limit: '1Gi'
        kubernetes_cpu_request : '4'
        commands:
        - |
            export ZFIT_DISABLE_TF_WARNINGS=1
            export PYTHONPATH=/tmp/rx/local
            export MPLCONFIGDIR=/tmp/rx/mplt

            source /root_install/bin/thisroot.sh

            which root
            if [[ $? -ne 0 ]];then
              echo "ROOT unavailable after first setup"
              exit 1
            fi

            pip install --target /tmp/rx/local --no-deps -r requirements.txt

            which root
            if [[ $? -ne 0 ]];then
              echo "ROOT unavailable after project install"
              exit 1
            fi

            pytest -n 2 src/rx_plots/tests

